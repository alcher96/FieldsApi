# Fields API
Fields API — тестовое задание, RESTful API для работы с географическими данными полей, хранящимися в KML-файлах. API позволяет получать список полей, их размеры, расстояния до центроидов и проверять принадлежность точки к полигону поля.
 Точки, лежащие на контуре полигона, считаются принадлежащими полю.

## Технологии

- **.NET 9.0**
- **ASP.NET Core** для создания REST API
- **SharpKml.Core** для парсинга KML-файлов
- **NetTopologySuite** для геометрических вычислений (проверка принадлежности точки полигону)
- **AutoMapper** для маппинга данных
- **Swagger** для документации API

## Возможности

- Получение списка всех полей с их координатами, размерами и центроидами (`GET /api/Fields`).
- Получение размера поля по ID (`GET /api/Fields/{id}/size`).
- Вычисление расстояния от заданной точки до центроида поля (`GET /api/Fields/{id}/distance`).
- Проверка принадлежности точки к полигону поля, включая точки на контуре (`GET /api/Fields/contains`).

## Запуск

1. Запустите приложение:

   ```bash
   dotnet run --project FieldsApi.Presentation
   ```

2. Откройте Swagger UI для тестирования API:

   ```
   http://localhost:<7004>/swagger
   ```


## Использование API

### Эндпоинты

1. **Получить все поля**

   ```
   GET /api/Fields
   ```

   **Ответ**:

   ```json
   [
     {
       "id": 1,
       "name": "TestField",
       "size": 100,
       "locations": {
         "center": [45.6962567581079, 41.3380610642585],
         "polygon": [[45.7074047669366, 41.3346809239899], ...]
       }
     }
   ]
   ```

2. **Получить размер поля**

   ```
   GET /api/Fields/{id}/size
   ```

   **Пример**: `GET /api/Fields/1/size`

   **Ответ**:

   ```json
   { "size": 100 }
   ```

   **Ошибочный случай** (несуществующий ID):

   ```json
   { "size": 0 }
   ```

3. **Получить расстояние до центроида**

   ```
   GET /api/Fields/{id}/distance?lat={latitude}&lng={longitude}
   ```

   **Пример**: `GET /api/Fields/1/distance?lat=45.6962567581079&lng=41.3380610642585`

   **Ответ**:

   ```json
   { "distance": 0 }
   ```

   **Ошибочный случай** (несуществующий ID):

   ```json
   { "distance": 0 }
   ```

4. **Проверить принадлежность точки полигону**

   ```
   GET /api/Fields/contains?lat={latitude}&lng={longitude}
   ```

   **Пример**: `GET /api/Fields/contains?lat=45.7074047669366&lng=41.3346809239899`

   **Ответ** (точка внутри или на контуре полигона):

   ```json
   {
     "id": 1,
     "name": "TestField"
   }
   ```

   **Ответ** (точка вне полигона):

   ```json
   false
   ```


## Важные Замечания по производительности!!!

- **Без кэширования**: Каждый запрос парсит KML-файлы заново, что может быть медленно для больших файлов (>10 МБ).
  - Не используется потоковая обработка, файлы проверяются in memory!


